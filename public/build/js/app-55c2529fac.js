angular.safeApply=function(e,t){e[e.$$phase||e.$root.$$phase?"$eval":"$apply"](t||function(){})},angular.isMobile=function(e){return/((iP([oa]+d|(hone)))|Android|WebOS|BlackBerry|windows (ce|phone))/i.test(e)}(navigator.userAgent||navigator.vendor||window.opera),angular.isOnline=function e(){var e=window.navigator&&window.navigator.onLine;return e},angular.storagePrefix=function(e){var t=["ymag",window.gid];return e&&e.length&&t.push(e),t.join(".")};var app=angular.module("app",["ngSanitize","LocalStorageModule","countdownTimer"]);app.config(["localStorageServiceProvider","$httpProvider",function(e,t){var n=angular.storagePrefix();t.defaults.headers.common.Authorization="Bearer "+window.api_token,e.setPrefix(n),e.setStorageCookie(1,"/")}]),app.run(["$rootScope",function(e){window.onclick=function(t){0==$(t.target).closest("div.card-actions.dropdown.open").length&&0==$(t.target).closest("#cities-list").length&&e.$broadcast("cardbox.close")}}]),app.REWRITE_BASE="/","dev-your-morning.rainbowriders.dk"==location.host&&(app.REWRITE_BASE="/public/"),app.API_PREFIX=app.REWRITE_BASE+"api/v1",app.controller("CalendarController",["$scope","$rootScope","EventsService","localStorageService",function(e,t,n,r){function a(){var t=i();if(t&&null!=t)s(t);else{e.calendars[0].selected=!0;var n=[];n.push(e.calendars[0]),r.set("cal",JSON.stringify(angular.copy(n)))}l()}function o(t){for(var n=0;n<e.calendars.length;n++)e.calendars[n].id==t.id&&(e.calendars[n].selected&&"undefined"!=e.calendars[n].selected?e.calendars[n].selected=!e.calendars[n].selected:e.calendars[n].selected=!0)}function i(){return JSON.parse(r.get("cal"))}function s(e){for(var t=0;t<e.length;t++)c(e[t])}function c(t){for(var n=0;n<e.calendars.length;n++)if(t.id==e.calendars[n].id){e.calendars[n].selected=t.selected||!1;break}}function u(){for(var t=0;t<e.calendars.length;t++)e.calendars[t].selected=!1}function l(){e.calendarEvents=[],e.hasEvents=!1;for(var t=0;t<e.calendars.length;t++)1==e.calendars[t].selected&&n.events(e.calendars[t].id).then(function(t){e.calendarEvents.push(t)})}e.calendars=[],e.events=[],e.hasEvents=!1,e.calendarEvents=[],e.init=function(t){e.calendars=t,a()},e.savePreferences=function(t){for(var n=[],a=0;a<e.calendars.length;a++)1==e.calendars[a].selected&&n.push(e.calendars[a]);r.set("cal",JSON.stringify(angular.copy(n))),l(),t&&t()},e.cancel=function(e){u(),s(i()),e&&e()},e.select=function(e){o(e)},e.$on("cardbox.close",function(){u(),s(i())}),e.$watchCollection("calendarEvents",function(){e.events=[];for(var t=0;t<e.calendarEvents.length;t++)for(var n in e.calendarEvents[t])e.events.push(e.calendarEvents[t][n]);e.events.length>0&&(e.hasEvents=!0),e.events.sort(function(e,t){return e=new Date(e.date),t=new Date(t.date),e<t?-1:e>t?1:0})})}]),app.controller("CustomEventController",["$scope","$rootScope","$interval","localStorageService","CustomEventService",function(e,t,n,r,a){function o(e){return e.split(".")}function i(){e.loading=!0,a.getEvent().then(function(e){c(e),P()})}function s(e){var t=e.split(" "),n=t[0].split("-"),r=t[1].split(":");return new Date(n[0],n[1]-1,n[2],r[0],r[1],r[2])}function c(t){return"No event created yet"==t?void(e.event=null):new Date(t.time)<new Date?void(e.event=null):(e.event=t,e.event.time=s(e.event.time),e.options.selectedTime=parseInt(t.time_option),e.loading=!1,e.eventTimeToString=m(e.event.time),e.eventDateToString=h(e.event.time),void u(e.event.time,e.options.selectedTime))}function u(e,t){var n=e-new Date;switch(t){case 1:var r=l(n),a=d(r.rest),o=f(a.rest),i=g(o.rest),s=p(i.rest);v(r.weeks,a.days,o.hours,i.minutes,s.seconds,t);break;case 2:var a=d(n),o=f(a.rest);i=g(o.rest);var s=p(i.rest);v(null,a.days,o.hours,i.minutes,s.seconds,t);break;case 3:var a=d(n);v(null,a.days,null,null,null,t)}}function l(e){return{weeks:parseInt(new Date(e).getTime()/w),rest:new Date(e).getTime()%w}}function d(e){return{days:parseInt(new Date(e).getTime()/y),rest:new Date(e).getTime()%y}}function f(e){return{hours:parseInt(new Date(e).getTime()/E),rest:new Date(e).getTime()%E}}function g(e){return{minutes:parseInt(new Date(e).getTime()/S),rest:new Date(e).getTime()%S}}function p(e){return{seconds:parseInt(new Date(e).getTime()/I)}}function v(t,n,r,a,o,i){switch(i){case 1:var s=1==t?t+" week ":t+" weeks ",c=1==n?n+" day ":n+" days ",u=1==r?r+" hour ":r+" hours ",l=1==a?a+" minute ":a+" minutes ",d=1==o?o+" second ":o+" seconds ";e.timeLeftToString="In "+s+c+u+l+d;break;case 2:var c=1==n?n+" day ":n+" days ",u=1==r?r+" hour ":r+" hours ",l=1==a?a+" minute ":a+" minutes ",d=1==o?o+" second ":o+" seconds ";e.timeLeftToString="In "+c+u+l+d;break;case 3:var c=1==n?n+" day ":n+" days ";e.timeLeftToString="In "+c}}function m(e){var t=e.getFullYear(),n=e.getDate()<10?"0"+e.getDate():e.getDate(),r=e.getMonth()<11?"0"+(e.getMonth()+1):e.getMonth()+1,a=e.getHours()<10?"0"+e.getHours():e.getHours(),o=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),i=n+"."+r+"."+t+", "+a+":"+o;return i}function h(e){var t=e.getFullYear(),n=e.getDate()<10?"0"+e.getDate():e.getDate(),r=e.getMonth()<11?"0"+(e.getMonth()+1):e.getMonth()+1,a=n+"."+r+"."+t;return a}e.eventTitle="",e.options={selectedTime:1},t.eventError={},e.event={},e.timeNow=new Date,e.loading=!0;var w=6048e5,y=864e5,E=36e5,S=6e4,I=1e3;e.setSelectedValue=function(t){return e.options.selectedTime=parseInt(t)},e.createEvent=function(n,r){t.eventError={};var s=document.getElementById("datepicker-autoclose").value;if(3!=e.options.selectedTime)var c=document.getElementById("custom-event-hours").value,u=document.getElementById("custom-event-minutes").value,l=document.getElementById("custom-event-seconds").value;""!=s&&"undefined"!=s||(t.eventError.eventDate="Please set a event date!"),""!=r&&"undefined"!=r||(t.eventError.eventTitle="Please set a event title!"),3==e.options.selectedTime&&(c=23,u=59,l=59);var d=o(s),f=new Date(d[2]+"-"+d[1]+"-"+d[0]);if(c?f.setHours(parseInt(c)):f.setHours(0),u?f.setMinutes(parseInt(u)):f.setMinutes(0),l?f.setSeconds(parseInt(l)):f.setSeconds(0),f<new Date&&(t.eventError.invalidTime="Event time must be in the future"),!(Object.keys(t.eventError).length>0)){var g={date:s,minutes:u||null,hours:c||null,seconds:l||null,title:r,time_option:e.options.selectedTime};null!=e.event?(g.id=e.event.id,a.updateEvent(g).then(function(e){i(),n&&n()})):a.createEvent(g).then(function(e){i(),n&&n()})}},e.cancel=function(e){e&&e()};var P=function(){n(function(){return null==e.event?void n.cancel(P):new Date(e.event.time)<new Date?e.event=null:void u(e.event.time,e.options.selectedTime)},1e3)};e.$watch("options.selectedTime",function(){1!=e.loading&&u(e.event.time,e.options.selectedTime)}),i()}]),app.controller("GmailController",["$scope","GmailService","$sce","localStorageService",function(e,t,n,r){function a(){e.query="";var t=[];return angular.forEach(["from","to","subject"],function(n,r,a){var o=e.filter[n];o.length&&t.push(n+": ("+o+")")}),e.query=t.join(" ").trim(),e.query}function o(e){for(var t in e.labels)if("INBOX"==e.labels[t])return!0;return!1}e.searchMode=!0,e.message=null,e.loading=!1,e.nextPageToken=null;var i,s=function(){return{from:"",to:"",subject:"",includeSpamTrash:!1}};(i=r.get("g_fltr"))||(i=JSON.stringify(s()),r.set("g_fltr",i)),e.filter=JSON.parse(i),e.messages=[],e.query=a(),e.savePreferences=function(t){return e.messages=[],e.nextPageToken=null,e.fetchMessages(t)},e.next=e.fetchMessages=function(n){if(e.loading)return!1;e.loading=!0,r.set("g_fltr",i=JSON.stringify(e.filter));var s={includeSpamTrash:!!e.filter.includeSpamTrash,q:a(),nextPageToken:e.nextPageToken};return t.fetchMessages(s).then(function(t){n&&n(),angular.safeApply(e,function(e){for(var n in t.messages)o(t.messages[n])&&e.messages.push(t.messages[n]);e.nextPageToken=t.nextPage,e.loading=!1})})["catch"](function(){e.loading=!1})},e.fetchMessages(),e.isUnRead=function(e){return e.hasOwnProperty("labels")&&-1<e.labels.indexOf("UNREAD")},e.fullMessageUrl=function(e){return n.trustAsResourceUrl(app.API_PREFIX+"/gmail/messages/"+e+"/body")},e.toggleSearchMode=function(t,n){t||(e.filter=JSON.parse(i)),n&&n()},e.backToList=function(){e.message=null},e.readMessage=function(n){e.loading=!0,t.get(n).then(function(r){angular.safeApply(e,function(e){e.message=r,e.loading=!1;e.messages.filter(function(e){return e.id==n})[0];e.messages.map(function(r){if(r.id==n&&e.isUnRead(r)){var a=r.labels.indexOf("UNREAD");r.labels.splice(a,1),t.markAsRead(n)}return r})})})["catch"](function(){e.loading=!1})}}]),app.controller("QuoteController",["$scope","$http",function(e,t){e.quote={id:null,quote:"",author:""},e.loading=!1,e.fetchRandom=function(){return!e.loading&&(e.loading=!0,void t.get(app.API_PREFIX+"/quotes/random").then(function(t){e.quote=t.data,e.loading=!1}))}}]),app.controller("RssController",["$scope","$timeout","$rootScope","localStorageService","FeedService","$q",function(e,t,n,r,a,o){function i(e){return window.lang+"."+e}function s(){return c(_.pluck(e.allFeeds,"id"))}function c(e){return e.map(function(e){return parseInt(e)})}function u(){var t,n=r.keys().indexOf(i("feeds"))>-1;g=[],n?(t=r.get(i("feeds")),t.length&&(g=c(t.split(",")))):g=s(),e.savedFeeds=angular.copy(g),f()}function l(e){var t=e.split(" "),n=t[0].split("-"),r=t[1].split(":");return new Date(n[0],n[1]-1,n[2],r[0],r[1],r[2])}function d(){var t=o.defer();return e.loading||!g.length?t.resolve([]):(e.loading=!0,a.news(g).then(function(n){e.loading=!1,e.articles=n;for(var r in e.articles)e.articles[r].pubDate.date=l(e.articles[r].pubDate.date);t.resolve(n)})),t.promise}function f(){e.allChecked=g.length==e.allFeeds.length}e.loading=!1,e.allChecked=!1,e.allFeeds=[];var g=[];e.savedFeeds=[],e.articles=[],e.$watch("feeds",function(e,t){return e!==t&&void f()},!0),e.toggleAll=function(e){g=1==e.target.checked?s():[]},e.init=function(t){e.allFeeds=t,u(),d()},e.savePreferences=function(t){return e.savedFeeds=c(g),r.set(i("feeds"),e.savedFeeds.join(",")),d().then(function(){t&&t()})},e.cancel=function(e){u(),e&&e()},e.trackUntrack=function(t){t=parseInt(t),e.trackable(t)?g=_.without(g,t):g.push(t)},e.trackable=function(e){return e=parseInt(e),_.indexOf(g,e)!=-1},e.customFeedUrl="",n.rssValidLink=!0,e.addCustomRSSFeed=function(t,r){n.rssValidLink=!0,n.rssValidName=!0;var o={url:t,name:r};t&&"undefined"!=t||(n.rssValidLink=!1),r&&"undefined"!=r||(n.rssValidName=!1),0!=n.rssValidLink&&0!=n.rssValidName&&a.createCustomFeed(o).then(function(t){document.getElementById("rss_url").value="",document.getElementById("rss_name").value="",e.allFeeds.push({id:t.id,name:t.name})},function(e){n.rssValidLink=!1})}}]),app.controller("SizerController",["$scope","$window",function(e,t){function n(){return $.browser.msie?.68:.8}var r=function(){var t=n(),r=$(window).height(),a=Math.round(r*t);angular.isMobile?(e.size1=190,e.size2=230,e.size3=140):(e.size1=Math.round(.34*a),e.size2=Math.round(.44*a),e.size3=a-(e.size1+e.size2)),e.resized=!0};setTimeout(r,100),$(window).on("resize",r)}]),app.controller("WeatherController",["$scope","$timeout","WeatherService","GeoService","localStorageService","$http",function(e,t,n,r,a,o){function i(t){o.get(app.API_PREFIX+"/geo/places?name="+t).then(function(t){var n=_.uniq(t.data.predictions)||[];e.cities=n})}function s(e,t){return e.address!==t.address&&e.address.length>=3}function c(){p(),e.filter=angular.copy(h)}function u(e){e&&e()}function l(){a.set("w_fltr",JSON.stringify(_.omit(e.filter,"address"))),h=angular.copy(e.filter)}function d(){return JSON.parse(a.get("w_fltr"))}function f(){return[e.filter.location.lat,e.filter.location.lng].join(",")}function g(t,n){r.lookup(t||r.getLatitude(),n||r.getLongitude()).then(function(t){p(),e.filter.address=t.formatted_address,l(),e.$emit("location.changed")})}function p(){w=!0,t(function(){w=!1},100)}var v,m=!1,h={units:"si",location:{},address:""};e.cities=[],e.filter=angular.copy(h),e.weather={},e.loading=!1;var w=!1;e.$watch("filter",function(e,t){return!w&&e!==t&&(m=!0,s(e,t)&&i(e.address),void(w=!1))},!0),e.$on("location.changed",function(){n.fetch(f(),{units:e.filter.units}).then(function(t){e.weather=angular.extend(t,e.filter);var n=(new Date).getHours(),r=(new Date).getDate(),a=1;for(var o in e.weather.hourly.data){var i=new Date(e.weather.hourly.data[o].time),s=i.getHours(),c=i.getDate();r==c&&n==s&&(e.currentHourSummary=e.weather.hourly.data[o].summary,e.currentHourIcon=e.icon(e.weather.hourly.data[o].icon),e.currnetHourTemperature=e.weather.hourly.data[o].temperature,e.startIndex=a+24),a++}e.city=e.weather.address.split(",")[0]})}),(v=d())?(e.filter=angular.copy(v),h=angular.copy(e.filter),g(v.location.lat,v.location.lng)):r.geolocate().then(function(t){e.filter.location={lat:t.getLatitude(),lng:t.getLongitude()},g()}),e.cancel=function(e){c(),u(e)},e.savePreferences=function(t){return!!m&&(!e.loading&&(e.loading=!0,m&&e.filter.address.length?(m=!1,r.geocode(e.filter.address).then(function(n){n&&n.hasOwnProperty("geometry")&&(p(),e.filter=angular.extend(e.filter,{location:n.geometry.location}),l(),e.$emit("location.changed"),u(t)),e.loading=!1})):(e.$emit("location.changed"),u(t)),!1))},e.locationToCity=function(e){return e&&e.indexOf(",")?_.first(e.split(", ")):""},e.selectCity=function(t){p(),e.filter.address=t.description,e.cities=null},e.icon=function(e){return app.REWRITE_BASE+"images/icons/w/"+e+".png"},e.showThisHour=function(e){var t=(new Date).getHours(),n=(new Date).getDate(),r=new Date(e.time),a=r.getHours(),o=r.getDate();return n==o&&t<a||n<o},e.getTimeToDate=function(e){return new Date(e)}}]),app.directive("cardBox",["$timeout","$rootScope",function(e,t){return{restrict:"E",scope:{title:"@"},transclude:{actions:"?cardBoxActions",body:"cardBoxBody"},link:function(n,r){function a(){Object.keys(t.eventError).length>0&&(t.eventError.invalidTime&&(document.getElementById("custom-event-hours").value="",document.getElementById("custom-event-minutes").value="",document.getElementById("custom-event-seconds").value=""),t.eventError={}),t.rssValidLink=!0;var e=document.getElementsByClassName("datepicker");e.length>0||angular.safeApply(n,function(e){e.editable=!1})}n.editable=!1,e(function(){n.hasActions=!!r.find("card-box-actions").text().length}),n.switchEditableMode=function(e){n.editable=!n.editable,e&&e()},n.close=a,t.$on("cardbox.close",a)},templateUrl:app.REWRITE_BASE+"assets/templates/card-box.html"}}]),app.directive("eventIcon",[function(){return{restrict:"E",scope:null,link:function(e,t,n){var r=JSON.parse(n.event),a=null;r.birthday?a="ti-gift":r.allDay||(a="ti-alarm-clock"),e.icon=a},template:'<i ng-if="icon" class="{{ icon }}">&nbsp;</i>'}}]),function(e){"use strict";e.module("countdownTimer",[]).directive("countdown",function(t,n){return{restrict:"A",transclude:!0,link:function(n,r,a){function o(){a.units=e.isArray(a.units)?a.units:a.units.split("|");var n,r,o=a.units[a.units.length-1],i={weeks:6048e5,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,milliseconds:1},c={},u="",l=new Date(a.endDate)-new Date;for(n in a.units)if(a.units.hasOwnProperty(n)){if(r=a.units[n].trim(),i[r.toLowerCase()]===!1)throw t.cancel(s),new Error("Cannot repeat unit: "+r);if(i.hasOwnProperty(r.toLowerCase())===!1)throw t.cancel(s),new Error("Unit: "+r+" is not supported. Please use following units: weeks, days, hours, minutes, seconds, milliseconds");c[r]=l/i[r.toLowerCase()],o===r?c[r]=Math.ceil(c[r]):c[r]=Math.floor(c[r]),l-=c[r]*i[r.toLowerCase()],i[r.toLowerCase()]=!1,u+=" "+c[r]+" "+r}return u}function i(){r.text(o())}var s;r.on("$destroy",function(){t.cancel(s)}),s=t(function(){i()},1)}}})}(angular),app.factory("CustomEventService",["$http","$httpParamSerializer",function(e,t){var n={};return n.createEvent=function(t){return e.post(app.API_PREFIX+"/custom-event",t).then(function(e){return e.data.data})},n.getEvent=function(){return e.get(app.API_PREFIX+"/custom-event").then(function(e){return e.data.data})},n.updateEvent=function(t){return e.post(app.API_PREFIX+"/custom-event/"+t.id,t).then(function(e){return e.data.data})},n}]),app.factory("EventsService",["$http","$httpParamSerializer",function(e,t){var n={};return n.events=function(n){var r=t({c:n,t:(new Date).getTime(),tz:0});return e.get(app.API_PREFIX+"/calendar/events?"+r).then(function(e){return e.data.data})},n}]),app.factory("FeedService",["$http","$httpParamSerializer",function(e,t){var n={};return n.news=function(n){var r=t({ids:n.join(",")});return e.get(app.API_PREFIX+"/feed/news?"+r).then(function(e){return e.data.data})},n.createCustomFeed=function(t){return e.post(app.API_PREFIX+"/feed",t).then(function(e){return e.data.data})},n}]),app.factory("GeoService",["$q","$http",function(e,t){function n(){return a.setLocation(40.7127837,-74.0059413),a}function r(e){t.get(app.API_PREFIX+"/geo/ip").then(function(t){var r=t.data;r.cityName.length&&"-"!=r.cityName?(a.setLocation(r.latitude,r.longitude),e.resolve(a)):e.resolve(n())})["catch"](function(){e.resolve(n())})}var a={lat:null,lng:null};return a.setLocation=function(e,t){return a.lat=parseFloat(e),a.lng=parseFloat(t),a},a.getLatitude=function(){return this.lat},a.getLongitude=function(){return this.lng},a.geolocate=function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){a.setLocation(e.coords.latitude,e.coords.longitude),t.resolve(a)},function(){return r(t)}):t.resolve(n()),t.promise},a.geocode=function(e){return t.get(app.API_PREFIX+"/geo/code?loc="+e).then(function(e){return e.data.results[0]})},a.lookup=function(e,n){return t.get(app.API_PREFIX+"/geo/lookup?latlng="+[e,n].join(",")).then(function(e){return e.data.results[0]})},a}]),app.factory("GmailService",["$http","$httpParamSerializer",function(e,t){var n={};return n.fetchMessages=function(n){return e.get(app.API_PREFIX+"/gmail/messages?"+t(n)).then(function(e){return e.data})},n.get=function(t){return e.get(app.API_PREFIX+"/gmail/messages/"+t+"?include=body").then(function(e){return e.data})},n.markAsRead=function(t){return e.get(app.API_PREFIX+"/gmail/messages/"+t+"/touch")},n}]),app.factory("WeatherService",["$http","$httpParamSerializer",function(e,t){var n={};return n.fetch=function(n,r){var a=angular.extend({coords:n,units:"si"},r||{}),o=app.API_PREFIX+"/weather/get?"+t(a);return e.get(o).then(function(e){return e.data})},n}]);